# Shopier Payment Gateway Activation

This plan outlines the steps to activate the Shopier payment gateway for real-world transactions.

## User Action Required

The user needs to gather the API Key and API Secret from their Shopier dashboard.

> [!IMPORTANT]
> You must have a Shopier account with API access enabled.
> To find your credentials:
>
> 1. Log in to your [Shopier Dashboard](https://www.shopier.com).
> 2. Navigate to the **API Settings** or **Developer** section.
> 3. Locate your **API Key** and **API Secret**.

## Webhook & Permission Settings

To ensure the AutonomaX agents can track sales and manage products, configure these settings in your Shopier App dashboard:

### 1. Webhook Olay Bildirimleri (Notifications)
- **Webhook bildirimleri**: Açık (Enabled)
- **Notification URL**: `https://autonomax-api-71658389068.us-central1.run.app/api/payment/shopier/callback`
- **Events**: Select all (or at least "Sipariş oluşturuldu").

### 2. İzin Kapsamı (Permissions)
Select the following to match your current access token:
- [x] **Siparişler**: Okuma & Yazma (orders:read, orders:write)
- [x] **Ürünler**: Okuma & Yazma (products:read, products:write)
- [x] **Kargolar**: Okuma & Yazma (shippings:read, shippings:write)
- [x] **Dükkan**: Okuma & Yazma (shop:read, shop:write)
- [x] **İadeler**: Okuma & Yazma (refunds:read, refunds:write)
- [x] **İndirimler**: Okuma & Yazma (discounts:read, discounts:write)

### 3. İletişim Bilgileri (Contact)
- **İnternet Sitesi**: `https://autonoma-x.myshopify.com`
- **E-posta**: `kagan@kagandolek.com`

## Proposed Changes

### Payment Service

#### [MODIFY] [shopier_service.py](file:///Users/pq/_youtube_ai_app_v3.0/modules/ai_agency/shopier_service.py)

Implemented [verify_callback](file:///Users/pq/_youtube_ai_app_v3.0/modules/ai_agency/shopier_service.py#116-141) to validate payment signatures from Shopier.

#### [MODIFY] [payment.py](file:///Users/pq/_youtube_ai_app_v3.0/backend/api/routes/payment.py)

Added `POST /shopier/callback` endpoint to handle status updates.

### Configuration

#### [MODIFY] [.env](file:///Users/pq/_youtube_ai_app_v3.0/.env)

Update the following placeholders with live credentials:

- `PAYMENT_SHOPIER_API_KEY`
- `PAYMENT_SHOPIER_API_SECRET`

## Verification Plan

### Manual Verification

1. **Run Revenue Launch Script**: Execute `python scripts/launch_revenue_operation.py` and verify that it generates a real Shopier payment HTML/link instead of a mock one.
2. **Payment Form Validation**: Inspect the generated HTML to ensure the `API_key` and other parameters are correctly populated.
3. **Transaction Flow (Optional)**: If the user wishes, they can open the generated payment link and verify the Shopier checkout page loads correctly (do not complete the transaction unless intending to test real payment).
